# Claude Work Handoff - Phase 5: Upstream UI Dropdowns

## Context

This is **Phase 5** of the shadcn/ui migration for Plane. Phases 0-4 are complete:
- Phase 0: Foundation (Radix primitives in `@plane/propel/primitives`)
- Phase 1: Leaf components (Badge, Avatar, Separator)
- Phase 2: Interactive primitives (Tooltip, Dropdown)
- Phase 3: Form controls (Checkbox, Switch, Select)
- Phase 4: Dialog/Modal components

## Phase 5 Status: COMPLETE

### Completed Migrations

**5A: Self-contained dropdowns (fully migrated to Radix):**
- `packages/ui/src/dropdowns/custom-menu.tsx` - Radix DropdownMenu
- `packages/ui/src/dropdowns/custom-select.tsx` - Radix Popover + Context
- `packages/ui/src/dropdowns/custom-search-select.tsx` - Radix Command + Popover
- `packages/ui/src/dropdown/single-select.tsx` - Radix Command + Popover
- `packages/ui/src/dropdown/multi-select.tsx` - Radix Command + Popover

**5B: HeadlessUI compatibility (kept for backwards compatibility):**
- `packages/ui/src/dropdowns/combo-box.tsx` - Kept HeadlessUI because consumers in `apps/web` directly use HeadlessUI primitives (`Combobox.Options`, `Combobox.Input`, `Combobox.Option`) as children

### Technical Notes

**Why combo-box.tsx was not migrated:**
Consumers in `apps/web/core/components/dropdowns/` (11 files) directly import from `@headlessui/react` and use HeadlessUI primitives as children of `ComboDropDown`. Migrating `ComboDropDown` to Radix would break these consumers because HeadlessUI children require HeadlessUI context.

**Future migration path for combo-box consumers:**
1. Each consumer file needs to be updated to:
   - Stop importing `Combobox` from `@headlessui/react`
   - Use Radix-based `CustomSearchSelect` or build with Radix primitives
2. After all consumers are migrated, `combo-box.tsx` can be deprecated

**Common components:**
The `packages/ui/src/dropdown/common/` components (button.tsx, input-search.tsx, options.tsx) use HeadlessUI internally. They are no longer used by `single-select.tsx` and `multi-select.tsx` (now Radix-based) but are still exported for backwards compatibility with any external consumers.

### Build Status

- `pnpm --filter @plane/ui build` - PASSES
- `pnpm --filter @plane/ui check:types` - PASSES

### Files Modified

```
packages/ui/src/dropdowns/custom-menu.tsx     # Radix DropdownMenu
packages/ui/src/dropdowns/custom-select.tsx   # Radix Popover + Context
packages/ui/src/dropdowns/custom-search-select.tsx  # Radix Command + Popover
packages/ui/src/dropdowns/combo-box.tsx       # Kept HeadlessUI (documented)
packages/ui/src/dropdowns/helper.tsx          # Updated onClick type for Event
packages/ui/src/dropdown/single-select.tsx    # Radix Command + Popover
packages/ui/src/dropdown/multi-select.tsx     # Radix Command + Popover
packages/ui/src/breadcrumbs/navigation-dropdown.tsx       # Fixed type errors
packages/ui/src/breadcrumbs/navigation-search-dropdown.tsx # Fixed type errors
packages/ui/src/link/block.tsx                # Fixed type errors
```

## Next Steps (Out of Scope)

1. **Consumer migration**: Update the 11 consumer files in `apps/web/core/components/dropdowns/` to use Radix-based components instead of HeadlessUI
2. **Storybook stories**: Add/update stories for the migrated components
3. **Remove HeadlessUI**: Once all consumers are migrated, remove HeadlessUI dependency

## Created

- Date: 2025-12-24
- Branch: phase-5-upstream-dropdowns
- Base: master
