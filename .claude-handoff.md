# Claude Work Handoff

## Original Plan

See: `plans/workspace-modes-refactor.md`

## Progress

### Phase 1: Mode Infrastructure ✅ COMPLETE

- Created `WorkspaceMode` type in `packages/types/src/workspace/`
- Created `useModeFromPath()` hook - derive mode from URL path
- Created `useModeNavigation()` hook - mode switching with last-visited memory
- Updated AppRail to use new hooks and highlight active mode
- Added keyboard shortcuts (Cmd+1/2/3) for mode switching

**Commit:** `fc7b3bc653 feat(navigation): restructure wiki and resources into own route groups`

### Phase 2: Route Group Restructuring ✅ COMPLETE

- Created `(wiki)` route group with layout.tsx and WikiSidebar
- Created `(resources)` route group with layout.tsx and ResourcesSidebar
- Moved wiki routes from `(projects)` to `(wiki)`
- Moved resources routes from `(projects)` to `(resources)`
- Updated `app/routes/core.ts` to register new routes
- URLs remain backwards compatible (`/wiki/*`, `/resources/*`)

### Phase 3: Extended Sidebars per Mode ✅ COMPLETE

- Added per-mode sidebar collapse states to theme store:
  - `wikiSidebarCollapsed` / `toggleWikiSidebar`
  - `resourcesSidebarCollapsed` / `toggleResourcesSidebar`
  - `projectsSidebarCollapsed` / `toggleProjectsSidebar`
- Enhanced WikiSidebar with full page tree and collections (using React Query)
- Enhanced ResourcesSidebar with filter options UI
- Transition animations already built into ResizableSidebar and Headless UI

### Phase 4: Navigation Polish ✅ COMPLETE

- Added keyboard shortcut hints to tooltips (e.g., "Projects ⌘1" on Mac, "Projects Ctrl+1" on Windows)
- Added `data-active` attribute to mode links for testing and accessibility
- Fixed HOC typing for `withDockItems` to properly expose `showLabel` prop
- Shortcut keys now passed through from `WORKSPACE_MODES` config to sidebar items

### Phase 5: Integration with Existing Plans ✅ COMPLETE

- Verified wiki routes work with new structure:
  - Wiki list page (`/:workspaceSlug/wiki`) - Grid/list view, search, collections
  - Wiki detail page (`/:workspaceSlug/wiki/:pageId`) - Page editor with loading/error states
  - Wiki modals: create page, create collection, delete page, share page
  - Wiki sidebar: page tree, collections, search
- Verified resources routes work with new structure:
  - Resources page (`/:workspaceSlug/resources`) - "Coming Soon" placeholder
  - Resources sidebar: type filters, quick filters
  - Resources header with breadcrumbs
- All React Query hooks for wiki (`useWikiPages`, `useWikiCollections`, `useWikiPageDetails`) properly exported
- Route registration in `core.ts` correctly organized into mode sections

## Clarified Requirements

| Decision                   | Answer                                                                        |
| -------------------------- | ----------------------------------------------------------------------------- |
| Default mode for new users | Projects (matches current behavior)                                           |
| Mode notification badges   | No badges (defer to future)                                                   |
| Cross-mode linking         | Regular URLs (keep it simple)                                                 |
| URL structure              | Explicit mode in URL (`/acme/wiki/...`)                                       |
| Other workspace features   | Projects mode (views, analytics, archives, stickies, drafts stay in Projects) |
| Mobile bottom tab bar      | Deferred                                                                      |
| Last visited persistence   | LocalStorage                                                                  |
| Mode icons                 | Match existing icons in codebase                                              |

## Key Files Modified in Phase 3

- `apps/web/core/store/client/theme.store.ts` - Added per-mode sidebar states
- `apps/web/app/(all)/[workspaceSlug]/(wiki)/_sidebar.tsx` - Full wiki sidebar with page tree
- `apps/web/app/(all)/[workspaceSlug]/(resources)/_sidebar.tsx` - Resources sidebar with filters

## Key Files Modified in Phase 4

- `apps/web/core/components/sidebar/sidebar-item.tsx` - Added tooltip with keyboard shortcut hints, `data-active` attribute
- `apps/web/ce/components/app-rail/app-rail-hoc.tsx` - Fixed HOC typing, pass `shortcutKey` to dock items

## Key Files in Phase 5 (Verification)

- `apps/web/app/routes/core.ts` - Wiki and Resources mode sections at lines 279-301
- `apps/web/app/(all)/[workspaceSlug]/(wiki)/wiki/(list)/page.tsx` - Wiki list page
- `apps/web/app/(all)/[workspaceSlug]/(wiki)/wiki/(detail)/[pageId]/page.tsx` - Wiki detail page
- `apps/web/app/(all)/[workspaceSlug]/(resources)/resources/page.tsx` - Resources placeholder page
- `apps/web/core/store/queries/wiki.ts` - React Query hooks for wiki (952 lines)

## Implementation Notes

1. **Per-Mode Sidebar State**: Each mode has its own collapse state stored in Zustand with localStorage persistence
   - Wiki sidebar collapse: `wiki_sidebar_collapsed`
   - Resources sidebar collapse: `resources_sidebar_collapsed`
   - Projects sidebar collapse: `projects_sidebar_collapsed`

2. **WikiSidebar Features**:
   - Page tree with hierarchical navigation
   - Collection support with nested items
   - Search functionality
   - Empty states for no pages/no search results
   - Uses React Query hooks: `useWikiPages`, `useWikiCollections`

3. **ResourcesSidebar Features**:
   - Filter by type (All, Files, Links, Images, Documents)
   - Quick filters section (Recently Added, Favorites, Shared)
   - Placeholder state since Resources feature is "Coming Soon"

4. **Keyboard Shortcut Tooltips** (Phase 4):
   - Platform-aware: Shows "⌘1" on Mac, "Ctrl+1" on Windows/Linux
   - Tooltips only appear in icon-only mode (when `showLabel=false`)
   - `formatShortcut()` helper function detects platform via userAgent

5. **Testing Support** (Phase 4):
   - Added `data-active` attribute to mode links for E2E test selectors
   - E.g., `page.getByRole('link', { name: /wiki/i }).toHaveAttribute('data-active', 'true')`

## Summary

**All 5 phases complete.** The workspace modes feature is fully implemented:

1. **Infrastructure** - Types, hooks (`useModeFromPath`, `useModeNavigation`, `useModeKeyboardShortcuts`)
2. **Route Groups** - Wiki and Resources moved to dedicated route groups with mode-specific layouts
3. **Sidebars** - Per-mode sidebars with independent collapse states
4. **Polish** - Keyboard shortcut tooltips, `data-active` attributes for testing
5. **Integration** - All existing wiki/resources features verified working

**Ready for:** Code review and testing in development environment.

## Context

- Created: 2025-12-23
- Branch: workspace-modes-phase1
- Base: master
