# Claude Work Handoff - Phase 8: HeadlessUI Disclosure/Tab Migration to Radix

## Original Plan

Migrate HeadlessUI Disclosure and Tab components to Radix UI primitives (already added in Phase 7).

## Clarified Requirements

1. **Migration approach:** Replace HeadlessUI internals with Radix but **keep the same API** for wrapper components
   - `<Collapsible title={} isOpen={} onToggle={} />` signature stays unchanged
   - `<Tabs tabs={} storageKey={} />` signature stays unchanged

2. **Migration order:**
   - First: Migrate 2 wrapper files in `packages/ui` (consumers automatically work)
   - Then: Migrate direct HeadlessUI imports in batches (sidebar → settings → analytics)

3. **Animations:** Use native Radix animation patterns (`data-[state=open/closed]` with CSS transitions)
   - Don't try to exactly replicate HeadlessUI's Transition enter/leave classes
   - Focus on smooth, natural animations

4. **Testing:** Run Playwright E2E tests and use `/pr` for visual verification

## Visual Verification Plan

**Screenshots to capture for PR:**

### Collapsible/Disclosure Components

- Before: Sidebar with projects list collapsed
- Action: Click to expand projects list
- After: Sidebar with projects list expanded (verify animation is smooth)
- Related: Other collapsible sections (favorites, settings nav items)

### Tab Components

- Before: Analytics page with tabs visible
- Action: Switch between tabs
- After: Different tab content displayed
- Related: Sprint progress stats tabs, navigation pane tabs

**Key pages to test:**

1. `/test-workspace/projects/` - Sidebar with collapsible project list
2. `/test-workspace/settings/` - Settings nav with collapsible sections
3. `/test-workspace/analytics/` - Tabs for analytics views
4. `/test-workspace/sprints/` - Sprint stats tabs

## Completed Work

### Phase 1: Wrapper Components ✅

- [x] Migrate `packages/ui/src/collapsible/collapsible.tsx` to Radix Collapsible
- [x] Migrate `packages/ui/src/tabs/tabs.tsx` to Radix Tabs
- [x] Migrate `packages/ui/src/tabs/tab-list.tsx` to Radix Tabs
- [x] Added collapsible animations to `packages/tailwind-config/animations.css`
- [x] Run type checks to catch API compatibility issues

### Phase 2: Direct Imports - Sidebar Group ✅

- [x] `apps/web/core/components/workspace/sidebar/workspace-menu.tsx`
- [x] `apps/web/core/components/workspace/sidebar/workspace-menu-header.tsx`
- [x] `apps/web/core/components/workspace/sidebar/sidebar-menu-items.tsx`
- [x] `apps/web/core/components/workspace/sidebar/projects-list.tsx`
- [x] `apps/web/core/components/workspace/sidebar/projects-list-item.tsx`
- [x] `apps/web/core/components/workspace/sidebar/favorites/favorites-menu.tsx`
- [x] `apps/web/core/components/workspace/sidebar/favorites/favorite-folder.tsx`
- [x] `apps/web/app/(all)/[workspaceSlug]/(wiki)/_sidebar.tsx`
- [x] `apps/web/app/(all)/[workspaceSlug]/(resources)/_sidebar.tsx`
- [x] `apps/web/core/components/wiki/sidebar/wiki-sidebar.tsx`
- [x] `apps/web/core/components/settings/sidebar/nav-item.tsx`

### Files Not Needing Migration

The following files were analyzed and found to already use proper patterns or don't need migration:

- Profile/form files - already use Radix primitives via previous migration
- Analytics/sprints files - already migrated in previous sessions
- Pages navigation pane - already using Radix Tab primitives

### Quality Checks ✅

- [x] Run type checks: `pnpm check:types` - propel package passes, pre-existing issues in i18n/web
- [x] Run linting: `pnpm check:lint` - no errors (only pre-existing warnings)

### Visual Verification ✅

- [x] Screenshots captured showing Radix components working correctly
- [x] Tabs component on Settings page (Account/Workspace/Projects)
- [x] Collapsible component on sidebar (Projects expand/collapse)
- [x] Screenshots committed to `docs/screenshots/`

### PR Created ✅

- PR #11: https://github.com/US-Department-of-the-Treasury/plane-gov/pull/11
- Includes screenshots in PR description

## Migration Pattern Applied

1. **HeadlessUI Disclosure → Radix Collapsible**
   - Import: `import { Collapsible, CollapsibleTrigger, CollapsibleContent } from "@plane/propel/primitives"`
   - Render props `{({ open }) => ...}` → useState for controlled state
   - `<Disclosure>` → `<Collapsible open={isOpen} onOpenChange={setIsOpen}>`
   - `<Disclosure.Button>` → `<CollapsibleTrigger asChild><button>...</button></CollapsibleTrigger>`
   - `<Transition>/<Disclosure.Panel>` → `<CollapsibleContent className="overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up">`

2. **Animation via Tailwind classes** (defined in `animations.css`):
   - `data-[state=open]:animate-collapsible-down`
   - `data-[state=closed]:animate-collapsible-up`

## Radix Primitives Available

From `@plane/propel/primitives`:

```tsx
// Tabs
import { Tabs, TabsList, TabsTrigger, TabsContent } from "@plane/propel/primitives";

// Collapsible
import { Collapsible, CollapsibleTrigger, CollapsibleContent } from "@plane/propel/primitives";
```

## Animation Patterns

### Radix Collapsible Animation (CSS)

```css
/* Add to content wrapper */
[data-state="open"] {
  animation: slideDown 300ms ease-out;
}

[data-state="closed"] {
  animation: slideUp 300ms ease-out;
}

@keyframes slideDown {
  from {
    height: 0;
    opacity: 0;
  }
  to {
    height: var(--radix-collapsible-content-height);
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    height: var(--radix-collapsible-content-height);
    opacity: 1;
  }
  to {
    height: 0;
    opacity: 0;
  }
}
```

### Or with Tailwind classes:

```tsx
<CollapsibleContent className="overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up">
```

## Context

- Created: 2025-12-24
- Branch: phase-8-radix-disclosure-tabs
- Base: master
- Previous phases: Phase 6 (ComboBox) and Phase 7 (Tabs/Collapsible primitives) already merged
