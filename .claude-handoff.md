# Claude Work Handoff

## Original Plan

See: `plans/workspace-modes-refactor.md`

## Progress

### Phase 1: Mode Infrastructure ✅ COMPLETE

- Created `WorkspaceMode` type in `packages/types/src/workspace/`
- Created `useModeFromPath()` hook - derive mode from URL path
- Created `useModeNavigation()` hook - mode switching with last-visited memory
- Updated AppRail to use new hooks and highlight active mode
- Added keyboard shortcuts (Cmd+1/2/3) for mode switching

**Commit:** `fc7b3bc653 feat(navigation): restructure wiki and resources into own route groups`

### Phase 2: Route Group Restructuring ✅ COMPLETE

- Created `(wiki)` route group with layout.tsx and WikiSidebar
- Created `(resources)` route group with layout.tsx and ResourcesSidebar
- Moved wiki routes from `(projects)` to `(wiki)`
- Moved resources routes from `(projects)` to `(resources)`
- Updated `app/routes/core.ts` to register new routes
- URLs remain backwards compatible (`/wiki/*`, `/resources/*`)

### Phase 3: Extended Sidebars per Mode ✅ COMPLETE

- Added per-mode sidebar collapse states to theme store:
  - `wikiSidebarCollapsed` / `toggleWikiSidebar`
  - `resourcesSidebarCollapsed` / `toggleResourcesSidebar`
  - `projectsSidebarCollapsed` / `toggleProjectsSidebar`
- Enhanced WikiSidebar with full page tree and collections (using React Query)
- Enhanced ResourcesSidebar with filter options UI
- Transition animations already built into ResizableSidebar and Headless UI

### Phase 4: Navigation Polish (PENDING)

- Polish mode switcher icons and labels
- Add mode indicator in AppRail
- Ensure consistent styling across modes

### Phase 5: Integration with Existing Plans (PENDING)

- Review existing wiki and resources features
- Ensure all routes work with new structure

## Clarified Requirements

| Decision                   | Answer                                                                        |
| -------------------------- | ----------------------------------------------------------------------------- |
| Default mode for new users | Projects (matches current behavior)                                           |
| Mode notification badges   | No badges (defer to future)                                                   |
| Cross-mode linking         | Regular URLs (keep it simple)                                                 |
| URL structure              | Explicit mode in URL (`/acme/wiki/...`)                                       |
| Other workspace features   | Projects mode (views, analytics, archives, stickies, drafts stay in Projects) |
| Mobile bottom tab bar      | Deferred                                                                      |
| Last visited persistence   | LocalStorage                                                                  |
| Mode icons                 | Match existing icons in codebase                                              |

## Key Files Modified in Phase 3

- `apps/web/core/store/client/theme.store.ts` - Added per-mode sidebar states
- `apps/web/app/(all)/[workspaceSlug]/(wiki)/_sidebar.tsx` - Full wiki sidebar with page tree
- `apps/web/app/(all)/[workspaceSlug]/(resources)/_sidebar.tsx` - Resources sidebar with filters

## Implementation Notes

1. **Per-Mode Sidebar State**: Each mode has its own collapse state stored in Zustand with localStorage persistence
   - Wiki sidebar collapse: `wiki_sidebar_collapsed`
   - Resources sidebar collapse: `resources_sidebar_collapsed`
   - Projects sidebar collapse: `projects_sidebar_collapsed`

2. **WikiSidebar Features**:
   - Page tree with hierarchical navigation
   - Collection support with nested items
   - Search functionality
   - Empty states for no pages/no search results
   - Uses React Query hooks: `useWikiPages`, `useWikiCollections`

3. **ResourcesSidebar Features**:
   - Filter by type (All, Files, Links, Images, Documents)
   - Quick filters section (Recently Added, Favorites, Shared)
   - Placeholder state since Resources feature is "Coming Soon"

## Context

- Created: 2025-12-23
- Branch: workspace-modes-phase1
- Base: master
