# Claude Work Handoff

## Original Plan

See: `plans/workspace-modes-refactor.md`

## Scope: Phase 1 Only (Mode Infrastructure)

This work session focuses **only on Phase 1** - creating the mode infrastructure foundation.

## Clarified Requirements

| Decision                   | Answer                                                                        |
| -------------------------- | ----------------------------------------------------------------------------- |
| Default mode for new users | Projects (matches current behavior)                                           |
| Mode notification badges   | No badges (defer to future)                                                   |
| Cross-mode linking         | Regular URLs (keep it simple)                                                 |
| URL structure              | Explicit mode in URL (`/acme/wiki/...`)                                       |
| Other workspace features   | Projects mode (views, analytics, archives, stickies, drafts stay in Projects) |
| Mobile bottom tab bar      | Deferred                                                                      |
| Last visited persistence   | LocalStorage                                                                  |
| Mode icons                 | Match existing icons in codebase                                              |

## Phase 1 Tasks

- [ ] Create `WorkspaceMode` type in `packages/types/src/workspace/`
- [ ] Create `useModeFromPath()` hook - derive mode from URL path
- [ ] Create `useModeNavigation()` hook - mode switching with last-visited memory
- [ ] Extend `ThemeStore` with mode-related preferences (sidebar state per mode)
- [ ] Update AppRail to use new hooks and highlight active mode
- [ ] Add keyboard shortcuts (Cmd+1/2/3) for mode switching

## Key Files to Reference

- `apps/web/core/components/navigation/app-rail-root.tsx` - Current AppRail
- `apps/web/core/lib/app-rail/` - AppRail context/provider
- `packages/constants/src/workspace.ts` - Navigation item constants
- `apps/web/core/store/client/theme.store.ts` - Zustand store for UI state

## Implementation Notes

1. **Mode Detection**: Mode is derived from URL, not stored in state
   - `/workspace/wiki/*` → wiki mode
   - `/workspace/resources/*` → resources mode
   - Everything else → projects mode (default)

2. **Last Visited Memory**: Store in localStorage per workspace

   ```
   plane_lastVisited_<workspaceSlug> = {
     projects: "/projects/abc123",
     wiki: "/wiki/getting-started",
     resources: "/resources"
   }
   ```

3. **Keyboard Shortcuts**:
   - Cmd+1 → Projects mode
   - Cmd+2 → Wiki mode
   - Cmd+3 → Resources mode

## Context

- Created: 2025-12-23
- Branch: workspace-modes-phase1
- Base: master
